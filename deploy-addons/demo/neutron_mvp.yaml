bootstrap:
  enabled: true
  script: |
    #public network
    neutron net-create "public" -- --is-default --router:external \
      --provider:network_type=flat \
      --provider:physical_network=public

    PUB_NET_ID=$(neutron net-show "public" -f value -c id)
    neutron subnet-create --name "public-subnet" \
      --ip-version 4 \
      $PUB_NET_ID "172.24.4.0/24" -- \
      --enable_dhcp=False

    neutron subnetpool-create \
      "shared-default-subnetpool" \
      --default-prefixlen "24" \
      --pool-prefix "10.0.0.0/8" \
      --shared \
      --is-default=True

    #private subnet
    neutron net-create "private"
    PRIV_NET_ID=$(neutron net-show "private" -f value -c id)
    neutron subnet-create --name "private-subnet" \
      --ip-version 4 \
      --dns-nameserver "8.8.8.8" \
      $PRIV_NET_ID \
      "10.0.0.0/24"

    neutron router-create "router1"
    ROUTER_ID=$(neutron router-show "router1" -f value -c id)
    PRIV_SUBNET_ID=$(neutron subnet-show "private-subnet" -f value -c id)
    neutron router-interface-add $ROUTER_ID $PRIV_SUBNET_ID
    neutron router-gateway-set $ROUTER_ID $PUB_NET_ID

network:
  interface:
    tunnel: docker0

conf:
  neutron:
    DEFAULT:
      l3_ha: False
      min_l3_agents_per_router: 1
      max_l3_agents_per_router: 1
      l3_ha_network_type: vxlan
      dhcp_agents_per_network: 1
  plugins:
    ml2_conf:
      ml2_type_flat:
        flat_networks: public
    openvswitch_agent:
      agent:
        tunnel_types: vxlan
      ovs:
        bridge_mappings: public:br-ex
  metadata_agent:
    DEFAULT:
      nova_metadata_ip: 10.96.120.234

endpoints:
  identity:
    auth:
      admin:
        username: charter_admin
        project_name: ctec
      user:
        project_name: demo
      nova:
        project_name: demo

manifests:
  job_db_drop: true
